<!DOCTYPE html>
<html>
<head>
	<title>TORRENT LIST</title>
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">

	<!-- jQuery library -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

	<!-- Popper JS -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>

	<!-- Latest compiled JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css" integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">
	<link rel="stylesheet" type="text/css" href="/style/css">
	<link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

</head>
<body>
	<div class="container">

	</div>


	<div id="web_head"></div>
	<div id="list_body"></div>

</body>

<script src="/socket.io/socket.io.js"></script>
<script type="text/javascript">


	var socket = io();

	if (window.innerWidth > 768) {
		$('#web_head').load('/torrent_head');
	} else {
		$('#web_head').load('/mobile_header');
	}


	$('#list_body').load('/view_list');

	
	function file_download(link) {
		location.href = link;
	}

	socket.emit('new_user');


	socket.on('DailyTop10',function(db_data){
		var count = db_data.length;
		$('#main_top_10').html('');
		for(i = 0; i < count; i++) 
		{

			$('#main_top_10').append('<li class="post_row">'+
											'<span class="num_pos">'+(i + 1)+'</span>'+
											'<label class="post_title"><a target="_blank" href="/post/'+db_data[i]['category']+'/'+db_data[i]['torrent_id']+'">'+db_data[i]['title']+'</a></label>'+
											'<span class="list_time">'+db_data[i]['data']+'</span>'+
											'<div class="clear"></div>'+
										'</li>')
		}
	})

	if (window.innerWidth > 768) {
		$('#web_head').load('/torrent_head');

	}



	var url = window.location.pathname.split('/');
	var link_len = url.length - 1;
	var res = url[1];


	if (link_len < 2) {
		var page = 1;
	} else if(link_len == 5) {
		var type = url[3];
		var page = url[link_len];
	} else {
		var type = null;

		var page = url[link_len];
	}



	$(document).ready(function(){
		setTimeout(function(){
			$('.view_header').show();
		},100);
	})


	setTimeout(function(){

		if (window.innerWidth < 768) {

			if (res == 'Disney') {
				$('.Netflix_m').show();
				$('.Streaming').addClass('active_menu');
				$('.Netflix_m').find('button').eq(1).css('color' , '#0072cf');
				$('.Netflix_m').find('button').eq(1).css('font-weight' , '900');
			} else if (res == 'Amazon'){
				$('.Netflix_m').show();
				$('.Streaming').addClass('active_menu');
				$('.Netflix_m').find('button').eq(2).css('color' , '#0072cf');
				$('.Netflix_m').find('button').eq(2).css('font-weight' , '900');
			} else if (res == 'HBO') {
				$('.Netflix_m').show();
				$('.Streaming').addClass('active_menu');
				$('.Netflix_m').find('button').eq(3).css('color' , '#0072cf');
				$('.Netflix_m').find('button').eq(3).css('font-weight' , '900');
			}
			

		}

		if (res == 'Netflix') {
			$('.type_holder').show();
			$('.type_holder').html('<a href="/Netflix" class="btn all_content">전체</a>'+
					'<a href="/Netflix/type/1/page/1" class="btn first_content">영화</a>'+
					'<a href="/Netflix/type/2/page/1" class="btn second_content">드라마</a>'+
					'<a href="/Netflix/type/3/page/1" class="btn third_content">다큐멘터리</a>');

			if (window.innerWidth < 768) {

				$('.Netflix_m').show();
				$('.Streaming').addClass('active_menu');
				$('.Netflix_m').find('button').eq(0).css('color' , '#0072cf');
			}

		} else if (res == 'Subtitle') {
			$('.type_holder').show();
			$('.type_holder').html('<a href="/Subtitle" class="btn all_content">전체</a>'+
					'<a href="/Subtitle/type/1/page/1" class="btn first_content">한글</a>'+
					'<a href="/Subtitle/type/2/page/1" class="btn second_content">영문</a>'+
					'<a href="/Subtitle/type/3/page/1" class="btn third_content">중문</a>'+
					'<a href="/Subtitle/type/4/page/1" class="btn fourt_content">일문</a>'+
					'<a href="/Subtitle/type/5/page/1" class="btn fifth_content">통합</a>'+
					'<a href="/Subtitle/type/6/page/1" class="btn last_content">기타</a>');
		}

		if (res == 'Drama'){
			$('.Broadcast').addClass('active_menu');
			$('.Broadcast .drop_down a').eq(0).find('button').addClass('active');

			if (window.innerWidth < 768) {
				$('.Drama_m').show();
				$('.Drama_m').find('button').eq(0).css('color' , '#0072cf');
			}

		} else if (res == 'Entertainment'){

			$('.Broadcast').addClass('active_menu');
			$('.Broadcast .drop_down a').eq(1).find('button').addClass('active');


			if (window.innerWidth < 768) {
				$('.Drama_m').show();
				$('.Drama_m').find('button').eq(1).css('color' , '#0072cf');
			}

		} else if (res == 'Documentary'){

			$('.Broadcast').addClass('active_menu');
			$('.Broadcast .drop_down a').eq(2).find('button').addClass('active');


			if (window.innerWidth < 768) {
				$('.Drama_m').show();
				$('.Drama_m').find('button').eq(2).css('color' , '#0072cf');
			}


		}   else {
			$('.'+res).addClass('active_menu');
			if (res == 'Streaming') {
				$('.all_content').addClass('active')


				if (window.innerWidth < 768) {
					$('.Drama_m').show();
				}

			}
		}


		$('.categories').html($('.active_menu a').html());

		if (type == null) {
			$('.all_content').addClass('active')
		} else if (type == 1) {
			$('.first_content').addClass('active')
		} else if (type == 2) {
			$('.second_content').addClass('active')
		} else if (type == 3) {
			$('.third_content').addClass('active')
		} else if (type == 4) {
			$('.fourt_content').addClass('active')
		} else if (type == 5) {
			$('.fifth_content').addClass('active')
		} else if (type == 6) {
			$('.last_content').addClass('active')
		}



	},1000)



	// socket.emit('page_count')


	socket.emit('getList',{'category' : res , 'page' : page , 'type' : type});


	socket.emit('loadgif');


	socket.on('list_result', function(data){

		var len = data.length;
		if (data[0]['category'] == "AdultMovie") {
			$('.table_data').show();

			$('.type_holder').show();
			$('.type_holder').html('<a href="/AdultMovie" class="btn all_content">전체</a>'+
					'<a href="/AdultMovie/type/1/page/1" class="btn first_content">일본유모</a>'+
					'<a href="/AdultMovie/type/2/page/1" class="btn second_content">일본노모</a>'+
					'<a href="/AdultMovie/type/3/page/1" class="btn third_content">서양</a>');


			for(x = 0; x < len; x++) {

				$('.table_data').append('<div class="col-sm-6 col-md-4 mb-4">'+
							'<a target="_blank" href="/post/'+data[x]['category']+'/'+data[x]['torrent_id']+'"><img src="'+data[x]['thumbnail']+'"></a>'+
							'<div class="title">'+
								'<strong class="post_title">'+data[x]['title']+'</strong>'+
							'</div>'+
							'<div class="size">'+
								'<small>'+data[x]['size']+'</small>'+
							'</div>'+
						'</div>')
			}
		}else {

			if(data[0]['category'] == "Netflix"){
				$('.type_holder').show();
				$('.type_holder').html('<a href="/Netflix" class="btn all_content">전체</a>'+
						'<a href="/Netflix/type/1/page/1" class="btn first_content">영화</a>'+
						'<a href="/Netflix/type/2/page/1" class="btn second_content">드라마</a>'+
						'<a href="/Netflix/type/3/page/1" class="btn third_content">다큐멘터리</a>');
			} else if (data[0]['category'] == "Subtitle") {
				$('.type_holder').show();
				$('.type_holder').html('<a href="/Subtitle" class="btn all_content">전체</a>'+
						'<a href="/Subtitle/type/1/page/1" class="btn first_content">한글</a>'+
						'<a href="/Subtitle/type/2/page/1" class="btn second_content">영문</a>'+
						'<a href="/Subtitle/type/3/page/1" class="btn third_content">중문</a>'+
						'<a href="/Subtitle/type/4/page/1" class="btn fourt_content">일문</a>'+
						'<a href="/Subtitle/type/5/page/1" class="btn fifth_content">통합</a>'+
						'<a href="/Subtitle/type/6/page/1" class="btn last_content">기타</a>');
			}
			$('table').show();
			

			for(x = 0; x < len; x++) {
				$('.list_result_holder').append('<tr>'+
								'<td class="list_id">'+data[x]['torrent_id']+'</td>'+
								'<td class="list_title"><a target="_blank" href="/post/'+data[x]['category']+'/'+data[x]['torrent_id']+'"><label>'+data[x]['title']+'</label></a></td>'+
								'<td class="list_view">'+data[x]['views']+'</td>'+
								'<td class="list_date">'+data[x]['data']+'</td>'+
							'</tr>');
			}
		}


	})

	socket.emit('get_latest');
	socket.emit('DailyTop10');


	socket.on('latest_update',function(db_data){
		var count = db_data.length;
		$('#latest_update').html('');
		for(i = 0; i < count; i++) 
		{
			$('#latest_update').append('<li class="post_row">'+
											'<span class="num_pos_a"><i class="fas fa-caret-right"></i></span>'+
											'<label class="post_title"><a target="_blank" href="/post/'+db_data[i]['category']+'/'+db_data[i]['torrent_id']+'">'+db_data[i]['title']+'</a></label>'+
											'<span class="list_time">'+db_data[i]['data']+'</span>'+
											'<div class="clear"></div>'+
										'</li>')
		}
	});

	socket.on('Notice' ,function(db_data){
		var count = db_data.length;
		$('#notice_list').html('');
		for(i = 0; i < 5; i++) 
		{

			$('#notice_list').append('<li class="post_row">'+
											'<span class="num_pos_a"><i class="fas fa-caret-right"></i></span>'+
											'<label class="post_title"><a target="_blank" href="/post/'+db_data[i]['category']+'/'+db_data[i]['torrent_id']+'">'+db_data[i]['title']+'</a></label>'+
											'<span class="list_time">'+db_data[i]['data']+'</span>'+
											'<div class="clear"></div>'+
										'</li>')
		}
	})

	socket.on('gif_data',function(data){
		$('.gif_holder').eq(0).html('<a target="_blank" href="//'+data[0]['link1']+'"><img src="'+data[0]['image_1']+'"></a>')
		$('.gif_holder').eq(1).html('<a target="_blank" href="//'+data[0]['link2']+'"><img src="'+data[0]['image_2']+'"></a>')
		$('.gif_holder').eq(2).html('<a target="_blank" href="//'+data[0]['link3']+'"><img src="'+data[0]['image_3']+'"></a>')
	})


	socket.on('torrent_total',function(data){
		var web_path_name = window.location.pathname.split('/')[1];
		var web_path_len = window.location.pathname.split('/').length;
		if (res == 'Streaming') {
			if (web_path_len == 2) {
				var comparer = 1;
			} else {
				var comparer = window.location.pathname.split('/')[web_path_len - 1];
			}
		} else {
			var comparer = window.location.pathname.split('/')[web_path_len];

		}

		if (comparer) {
			var start = (Math.ceil(comparer / 5) * 5) - 4;
			var last = (Math.ceil(comparer / 5) * 5);
		} else {
			
			setTimeout(function(){
				$('.pagination').find('a').eq(0).addClass('active')
			},200)

			var start = (Math.ceil(1 / 5) * 5) - 4;
			var last = (Math.ceil(1 / 5) * 5);
		}



		if (start < 1 && last < 5) {
			start = 1;
			last = 5;
		}


		var active_page = comparer;
		var pages = data.count / 20;

		if (data.type != null) {
			var link_type = '/type/'+data.type;
		} else {
			var link_type = '';
		}
		pages = Math.ceil(pages);
		if (pages <= last) {
			last = pages;
		}
		

		if (start > 5) {
			$('.pagination').append('<a href="/'+web_path_name+link_type+'/page/'+(start - 5)+'">&laquo;</a>')
		} 		


		for(i = start; i <= last; i++) {

			if (i == comparer) {
				$('.pagination').append('<a href="/'+web_path_name+link_type+'/page/'+i+'" class="active">'+i+'</a>')
			} else {
				$('.pagination').append('<a href="/'+web_path_name+link_type+'/page/'+i+'" >'+i+'</a>')
			}

		}

		if (last < pages) {
			$('.pagination').append('<a href="/'+web_path_name+link_type+'/page/'+(eval(start) + 5)+'">&raquo;</a>')
		}


		
	})	
	



</script>
<script src="/socket.io/socket.io.js"></script>
</html>